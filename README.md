# Content
* [1.Introducing](#1.Introducing)
    * [Plugin Summary](#Plugin-Summary)
    * [How to Enable VPE](#How-to-Enable-VPE)
    * [Run VPE with FFmpeg](#Run-VPE-with-FFmpeg)
* [2.Plugin Parameters](#2.Plugin-Parameters)
    * [Device](#Device)
    * [Decoder](#Decoder)
    * [VP9 Encoder](#VP9-Encoder)
    * [H264 H265 Encoder](#H264-H265-Encoder)
    * [Spliter](#Spliter)
    * [PP](#PP)
    * [HWuploader](#HWuploader)
* [3.FFmpeg Command Line Examples](#3.FFmpeg-Command-Line-Examples)
    * [Transcoding](#Transcoding)
    * [Decoding Only](#Decoding-Only)
    * [Encoding Only](#Encoding-Only)
    * [Transcoding with parameters](#Transcoding-with-parameters)
    * [Downscaling First Pass](#Downscaling-First-Pass)
* [4.Use VPE in K8s](#4.Use-VPE-in-K8S)

# 1.Introducing

This project is VeriSilicon VPE plugin development trunk, it keep synced with FFmpeg master branch.

## Plugin Summary

| Plugin     | Type    | Comments                                                                                                      | Capbilities                                        |
|---------------|---------|---------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
| vpe           | device  | FFmpeg device which be used by parameter “\-init\_hw\_device”, for example “ffmpeg vpe=dev0:/dev/transcoder0” |                                                    |
| h264enc\_vpe  | encoder | VeriSilicon H264 hardware encoder interface                                                                   | Maximum 4K 60Hz, High 10 Profile, levels 1 \- 5\.2 |
| hevcenc\_vpe  | encoder | VeriSilicon HEVC hardware encoder interface                                                                   | Maximum 4K 60Hz, Main 10 Profile, levels 5\.1      |
| vp9enc\_vpe   | encoder | VeriSilicon VP9 hardware encoder interface                                                                    | Maximum 4K 60Hz Profile 2 \(10\-bit\)              |
| h264\_vpe     | decoder | VeriSilicon H264 hardware decoder interface                                                                   | Maximum 4K 60Hz, High 10 Profile, levels 1 \- 5\.2 |
| hevc\_vpe     | decoder | VeriSilicon HEVC hardware decoder interface                                                                   | Maximum 4K 60Hz, Main 10 Profile, levels 5\.1      |
| vp9\_vpe      | decoder | VeriSilicon VP9 hardware decoder interface                                                                    | Maximum 4K 60Hz Profile 2 \(10\-bit\)              |
| vpe\_pp       | filter  | VeriSilicon Post Processing Filter                                                                            | Downscaling videos minimal to 180                  |
| spliter\_vpe  | filter  | VeriSilicon Spliter                                                                                           | Spliter input video to Maximum 4 paths             |
| hwupload\_vpe | filter  | VeriSilicon Hardware Uploader                                                                                 | Upload raw data to encoders                        |

## How to Enable VPE
1. Install VPE supported hardware like Solios-X to your computer;
2. Download VPE driver https://github.com/VeriSilicon/vpe and follow the readme.md to install;
    ```bash
    #git clone git@github.com:VeriSilicon/vpe.git
    #cd vpe
    #make
    #sudo make install
    ```
3. Config FFmpeg by command：
    ```bash
    # ./configure --enable-vpe  --extra-ldflags="-L/lib/vpe" --extra-libs="-lvpi"
    ```
4. Build FFmpeg:
    ```bash
    # make
    ```

## Run VPE with FFmpeg

```bash
./ffmpeg -y -init_hw_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 -c:v h264_vpe -transcode 1 -i ${INPUT_FILE_H264} -filter_complex 'spliter_vpe=outputs=1[out0]' -map '[out0]' -c:v h264enc_vpe -preset fast -b:v 10000000 out0.h264
```

Get more examples:  [Transcoding](#Transcoding), [Decoding Only](#Decoding-Only), [Encoding Only](#Encoding-Only), [Transcoding with parameters](#Transcoding-with-parameters), [Downscaling First Pass](#Downscaling-First-Pass)

# 2.Plugin Parameters
## Device

| Option     | Sub Option | Type   | Description                                | Range of Value Valid | Default Value |
|------------|------------|--------|--------------------------------------------|----------------------|---------------|
| priority   |            | string | Priority of codec, live is higher than vod | live/vod             | vod           |
| vpeloglevel |            | int    | Set the VPE log level, 0 means disable                      | 0-9                 |

Example：
```bash
ffmpeg -init_hw_device vpe=dev0:/dev/transcoder0,priority=live,vpeloglevel=0
```
## Decoder
|   Option        | Sub Option | Type   | Description                                                                 | Range of Value Valid | Default Value    |
|---------------|------------|--------|-----------------------------------------------------------------------------|----------------------|------------------|
| -low_res    |            | string | Set output number and set the downscaling size for each stream.                        |                      | null             |
| -dev         |            | string | Set device name hence                                                         |                      | /dev/transcoder0 |
| -transcode |            | int | Whether need doing transcoding, for decoder and encoder only case, this opition is not required.| 0,1        |0            |


Example：
Below example will do hevc->h264 transcoding and output two streams: one is orignal resolution h264 stream, the second one is 640x360 h264 stream.
```bash
ffmpeg -y -init_hw_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 -c:v hevc_vpe -transcode 1 -low_res "2:(640x360)" -i ${INPUT_FILE_H264} -filter_complex 'spliter_vpe=outputs=2[out0][out1]' -map '[out0]' -c:v h264enc_vpe out0.h264 -map '[out1]' -c:v h264enc_vpe out1.h264
```

**"low_res" more detail:**

"low_res" opition for decoder supports multiple formats, supporse orignal stream resolution is W x H:

1. Fixed resolution. Below example will output 4 streams: [W x H], [1920x1080], [1280x720], [640x360]:
    > low_res=4:(1920x1080)(1280x720)(640x360)
2. Relative resolution. Below example will output 4 streams: [W x H], [960x540], [480x270], [640x360]
    > low_res=4:(d2)(d4)(d8)
3. Equal proportion: H or H will follow the scaling ratio.
   Below example will output 4 streams: [W x H], [(W x (1080/H)) x 1080], [(W x (720/H) x 720], [(W x (360/H) x 360]
    > low_res=4:(-1x1080)(-1x720)(-1x360)

   Below example will output 4 streams: [W x H], [(1920 x (H*1920/W)], [1280 x (H*1280/W)], [640 x (H*640/W)]

    > low_res=4:(1920x-1)(1280x-1)(640x-1)
4. Cropping and scaling: Two sets are required for each stream: scropping setting and scaling setting. IN below example, the first scropping window is (10,10,3840x2160), the scaling target resolution is 1920x1080
    > low_res='2:(10,10,3840,2160,1920x1080)'

Note: low_res is also for vpe_pp filter, the only difference is only the streams numbers is not required in vpe_pp filer, for example:
> low_res=(1920x1080)(1280x720)(640x360).

## VP9 Encoder

| Option             | Sub Option      | Type   | Description                                                                                              | Range of Value Valid                                                                                                                                                                 | Default Value              |
|--------------------|-----------------|--------|----------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
| \-b:v                                     |                 | int   |Target bitrate for rate control\.     | \[10000\.\.60000000\]                | 1000000        |
| \-r (for input\)                         |                 | int    | Input picture rate numerator\.        | \[1\.\.1048575\]                     | 30             |
|                                           |                 | int    | Input picture rate denominator\.      | \[1\.\.1048575\]                     | 1              |
| \-r (for output\)                        |                 | int    | Output picture rate numerator\.       | \[1\.\.1048575\]                     | inputRateNumer |
|                                           |                 | int    | Output picture rate denominator\.     | \[1\.\.1048575\]                     | inputRateDenom |
| \-enc\-params                             | intraPicRate    | int    | Intra picture rate in frames\.        | \[0\.\.INT\_MAX\]                    | 0              |
|                                           | bitrateWindow   | int    | Bitrate window length in frames\.     | \[1\.\.300\]                         | 150            |
|                                           | qpHdr           | int    | Initial QP used for the first frame\. | \[\-1\.\.255\]                       | \-1            |
|                                           | qpMin           | int    | Minimum frame header QP\.             | \[0\.\.255\]                         | 10             |
|                                           | qpMax           | int    | Maximum frame header QP\.             | \[0\.\.255\]                         | 255            |
|                                           | fixedIntraQp    | int    | Fixed Intra QP, 0 = disabled\.        | \[0\.\.255\]                         | 0              |
|                                           | picRc           | int    | Picture rate control enable\.         | 0=OFF, 1=ON                          | 1              |
|                                           | mcompFilterType | int    | Interpolation filter mode\.           | \[0\.\.4\]                           | 4              |
|                                           | force8bit       | int    | Force to output 8bit stream           | \[0\.\.1\]                           | 0              |
|                                           | refFrameScheme  | int    | Reference frame update scheme\.       | \[0\.\.4\]                           | 4              |
|                                           | filterLevel     | int    | Filter strength level for deblocking  | \[0\.\.64\]                          | 64             |
|                                           | filterSharpness | int    | Filter sharpness for deblocking\.     | \[0\.\.8\], 8=auto                   | 8              |
| \-effort           | effort          | int    | Encoder effort level\.                | \[0\.\.5\]0=fastest,<br>5=best quality   | 0              |
| \-lag_in_frames  | lag_in_frames | int    | Number of frames to lag\. Up to 25\.  | \[0\.\.25\]                          | 7              |
| \-passes     | passes          | int    | Number of passes\.                    | \[1\.\.2\]                           | 1              |
| \-profile:v                               |                 | int    | Encoder profile                       | \[0\.\.3\]                           | 0              |
| \-preset           |                 | string | Encoding preset\.                                                                                        | superfast<br>fast<br>medium<br>slow<br>superslow                                                                                                                                                 | none                       |

Example:
> -enc_params "ref_frame_scheme=4:lag_in_frames=18:passes=2:bitrate_window=60:effort=0:intra_pic_rate=60"

## H264 H265 Encoder

| Option             | Sub Option      | Type   | Description                                                                                                | Range                                                                                                                                                    | Default Value              |
|--------------------|-----------------|--------|----------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
| \-b:v              |                 | int    | Target bitrate for rate control\.                                                                        | \[10000\.\.levelMax\]                                                                                                                                                                | 1000000                    |
| \-r (for input\)  |                 | int    | Input picture rate numerator\.                                                                           | \[1\.\.1048575\]                                                                                                                                                                     | 30                         |
|                    |                 | int    | Input picture rate denominator\.                                                                         | \[1\.\.1048575\]                                                                                                                                                                     | 1                          |
| \-r (for output\) |                 | int    | Output picture rate numerator\.                                                                          | \[1\.\.1048575\]                                                                                                                                                                     | input             |
|                    |                 | int    | Output picture rate denominator\.                                                                        | \[1\.\.1048575\]                                                                                                                                                                     | input             |
| \-profile:v        |                 | int    | Encode profile:HEVC:0\-2; H264:9\-12                                                                     | HEVC: main main10 H264:baseline/main/high/high10                                                                                                                                     | main                       |
| \-level            |                 | int    | Encode level                                                                                             | HEVC support level:<br>(1\.0; 2\.0; 2\.1; 3\.0; 3\.1; 4\.0; 4\.1; 5\.0; 5\.1\) <br><br>H264 support level:<br>(1; 1b; 1\.1; 1\.2; 1\.3; 2; 2\.1; 2\.2; 3; 3\.1; 3\.2; 4; 4\.1; 4\.2; 5; 5\.1; 5\.2\) | HEVC: 5\.1 <br>H264: 5\.2      |
| \-enc-params   | intraPicRate    | int    | Intra picture rate in frames\.                                                                           | \[0\.\.INT\_MAX\]                                                                                                                                                                    | 0                          |
|                    | bitrateWindow   | int    | Bitrate window length in frames\.                                                                        | \[1\.\.300\]                                                                                                                                                                         | intraPicRate               |
|                    | intraQpDelta    | int    | Intra QP delta, QP difference between target QP and intra frame QP\.                                     | \[\-51\.\.51\]                                                                                                                                                                       | \-5                        |
|                    | qpHdr           | int    | Initial target QP\.                                                                                      | \[\-1\.\.255\]                                                                                                                                                                       | 26                         |
|                    | qpMin           | int    | Minimum frame header QP for any slices\.                                                                 | \[0\.\.51\]                                                                                                                                                                          | 0                          |
|                    | qpMax           | int    | Maximum frame header QP for any slices\.                                                                 | \[0\.\.51\]                                                                                                                                                                          | 51                         |
|                    | fixedIntraQp    | int    | Fixed Intra QP\. Use fixed QP value for every intra frame in stream\.                                    | \[0\.\.51\]                                                                                                                                                                          | 0                          |
|                    | tier            | int    | Encoder tier                                                                                             | 0  \-main tier ; 1  \-high tier                                                                                                                                                      | 0                          |
|                    | byteStream      | int    | Stream type\.                                                                                            | 0 \- NAL units;  <br>1 \- byte stream according to Hevc Standard Annex B                                                                                                                  | 1                          |
|                    | videoRange      | int    | Video signal sample range value in Hevc stream\.                                                         | 0 \- Y range in \[16\.\.235\] Cb,Cr in \[16\.\.240\] ; <br>1 \- Y,Cb,Cr range in \[0\.\.255\]                                                                                            | 1                          |
|                    | sei             | int    | Enable SEI messages \(buffering period \+ picture timing\)\.                                             | \[0\.\.INT\_MAX\]                                                                                                                                                                    | 0                          |
|                    | cabac           | int    | Select cavlc or cabac, only for H264 encoding                                                            | 0 for cavlc, 1 for cabac\.                                                                                                                                                           | 1                          |
|                    | sliceSize       | int    | Slice size in number of CTU rows\. 0 to encode each picture in one slice\.                               | \[0\.\.height/ctu\_size\]                                                                                                                                                            | 0                          |
|                    | bitVarRangeI    | int    | Percent variations over average bits per frame for I frame\.                                             | \[10\.\.10000\]                                                                                                                                                                      | 10000                      |
|                    | bitVarRangeP    | int    | Percent variations over average bits per frame for P frame\.                                             | \[10\.\.10000\]                                                                                                                                                                      | 10000                      |
|                    | bitVarRangeB    | int    | Percent variations over average bits per frame for B frame\.                                             | \[10\.\.10000\]                                                                                                                                                                      | 10000                      |
|                    | picRc           | int    | Picture rate control enable\.                                                                            | 0=OFF, 1=ON                                                                                                                                                                          | 0                          |
|                    | ctbRc           | int    | CTB QP adjustment mode for Rate Control and Subjective Quality\.                                         | \[0\.\.1\]                                                                                                                                                                           | 0                          |
|                    | tolCtbRcInter   | float  | Tolerance of Ctb Rate Control for INTER frames\.                                                         | Float point number, \[targetPicSize/\(1\+tolCtbRcInter\), argetPicSize\*\(1\+tolCtbRcInter\)\]; <br><br>A negative number means no bit rate limit in Ctb Rc                                  | 0\.0                       |
|                    | tolCtbRcIntra   | float  | Tolerance of Ctb Rate Control for INTRA frames\.                                                         | float point number                                                                                                                                                                   | \-1\.0                     |
|                    | ctbRowQpStep    | int    | The maximum accumulated QP adjustment step per CTB Row allowed by Ctb Rate Control\.                     | QP\_step\_per\_CTB = \(ctbRowQpStep / Ctb\_per\_Row\) and limited by maximum = 4                                                                                                     | H264: 4; <br>HEVC: 16          |
|                    | picQpDeltaRange | int    | Qp\_Delta Range in Picture RC                                                                            | \[Min:Max\] <br>Min: \[\-1\.\.\-10\], Max: \[1\.\.10\]                                                                                                                                   | Min:\-2; Max:3             |
|                    | hrdConformance  | int    | Enable HRD conformance\. Uses standard defined model to limit bitrate variance\.                         | \[0\.\.1\]                                                                                                                                                                           | 0                          |
|                    | cpbSize         | int    | HRD Coded Picture Buffer size in bits\.                                                                  | > 0                                                                                                                                                                                  | 1000000                    |
|                    | gopSize         | int    | GOP Size\.                                                                                               | \[0\.\.8\] <br>0 adaptive size, 1\-7 fixed size                                                                                                                                          | 0                          |
|                    | gopLowdelay     | int    | Enable default lowDelay GOP configuration\. If \-\-gopConfig not specified, only valid for GOP size <= 4 | \[0\.\.1\]                                                                                                                                                                           | 0                          |
|                    | qpMinI          | int    | qpMin for I Slice\.                                                                                      | \[0\.\.51\]                                                                                                                                                                          | 0                          |
|                    | qpMaxI          | int    | qpMax for I Slice\.                                                                                      | \[0\.\.51\]                                                                                                                                                                          | 51                         |
|                    | bFrameQpDelta   | int    | QP difference between BFrame QP and target QP\.                                                          | \[\-1\.\.51\]                                                                                                                                                                        | \-1                        |
|                    | chromaQpOffset  | int    | Chroma QP offset\.                                                                                       | \[\-12\.\.12\]                                                                                                                                                                       | 0                          |
|                    | vbr             | int    | Enable variable Bit Rate Control by qpMin\.                                                              | 0=OFF, 1=ON                                                                                                                                                                          | 0                          |
|                    | userData        | string | SEI User data file name\. <br>File is read and inserted as SEI message before first frame\.                  |                                                                                                                                                                                      |                            |
|                    | intraArea       | int    | CTB coordinates specifying rectangular area of CTBs to force encoding in intra mode\.                    | left : top : right : bottom                                                                                                                                                                | \-1                        |
|                    | ipcm1Area       | int    | CTB coordinates specifying rectangular area of CTBs to force encoding in IPCM mode\.                     | left : top : right : bottom                                                                                                                                                                | \-1                        |
|                    | ipcm2Area       | int    | CTB coordinates specifying rectangular area of CTBs to force encoding in IPCM mode\.                     | left : top : right : bottom                                                                                                                                                                | \-1                        |
|                    | constChroma     | int    | Enable setting chroma a constant pixel value\.                                                           | \[0\.\.1\]                                                                                                                                                                           | 0                          |
|                    | constCb         | int    | The constant pixel value for Cb\.                                                                        | 8bit \[0\.\.255\], <br> 10bit \[0\.\.1023\]                                                                                                                                               | 8\-bit:  128, <br>10\-bit: 512 |
|                    | constCr         | int    | The constant pixel value for Cr\.                                                                        | 8bit \[0\.\.255\], <br> 10bit \[0\.\.1023\]                                                                                                                                               | 8\-bit:  128, <br>10\-bit: 512 |
|                    | rdoLevel        | int    | Programable HW RDO Level\.                                                                               | \[1\.\.3\]                                                                                                                                                                           | 1                          |
|                    | ssim            | int    | Enable SSIM Calculation\.                                                                                | 0 \- Disable, 1 \- Enable                                                                                                                                                            | 1                          |
|                    | vuiTimingInfo   | int    | Write VUI timing info in SPS\.                                                                           | 0 \- Disable, 1 \- Enable                                                                                                                                                            | 1                          |
|                    | lookaheadDepth  | int    | Number of lookahead frames\.                                                                             | \[0\.\.40\]                                                                                                                                                                          | 0                          |
|                    | force8bit       | int    | Force to output 8bit stream\.                                                                            | \[0\.\.1\]                                                                                                                                                                           | 0                          |
| \-crf              |                 | int    | VCE Constant rate factor mode\. Works with lookahead turned on\.                                         | \[\-1\.\.51\]                                                                                                                                                                        | \-1                        |
| \-preset           |                 | string | Encoding preset\.                                                                                        | superfast<br>fast<br>medium<br>slow<br>superslow

Example:
> -enc_params "lookahead_depth=10:chroma_qp_offset=2:bitrate_window=180:intra_pic_rate=60"

# Preset detail parameters:
| Level     | format | Parameters setting                                                                                                                                          | comment                                                         |
|-----------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
| superfast | h264   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=1                                                                                   |                                                                 |
|           | hevc   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=1 <br>\-\-rdoLevel=1                                                                    |                                                                 |
|           | vp9    |  <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-effort=0 <br>\-\-mcompFilterType=4 <br>\-\-refFrameScheme=0 <br>\-\-lag\-in\-frames=0                                                    |                                                                 |
| fast      | h264   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=4                                                                                   |  ctbRc: <br>1:better subjective quality; <br>0:better objective quality;|
|           | hevc   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=4 <br>\-\-rdoLevel=1                                                                    |                                                                 |
|           | vp9    |  <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-effort=0 <br>\-\-mcompFilterType=4 <br>\-\-refFrameScheme=4 <br>\-\-lag\-in\-frames=7                                                    |                                                                 |
| medium    | h264   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=4 <br>\-\-lookaheadDepth=20                                                             |                                                                 |
|           | hevc   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=4 <br>\-\-rdoLevel=1 <br>\-\-lookaheadDepth=20                                              |                                                                 |
|           | vp9    |  <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-effort=0 <br>\-\-mcompFilterType=4 <br>\-\-refFrameScheme=4 <br>\-\-arf\-temporal\-filter\-enabled=0 <br>\-\-passes=2 <br>\-\-lag\-in\-frames=12 |                                                                 |
| slow      | h264   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=0 <br>\-\-lookaheadDepth=30                                                             | adaptive GOP size                                               |
|           | hevc   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=0 <br>\-\-rdoLevel=2 <br>\-\-lookaheadDepth=30                                              | adaptive GOP size                                               |
|           | vp9    |  <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-effort=1 <br>\-\-mcompFilterType=4 <br>\-\-refFrameScheme=4 <br>\-\-arf\-temporal\-filter\-enabled=0 <br>\-\-passes=2 <br>\-\-lag\-in\-frames=25 | 2\-pass and max lag\-in\-frame setting                          |
| superslow | h264   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=0 <br>\-\-lookaheadDepth=40                                                             | adaptive GOP size                                               |
|           | hevc   |  <br>\-\-intraQpDelta=\-2 <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-ctbRc=0 <br>\-\-gopSize=0 <br>\-\-rdoLevel=3 <br>\-\-lookaheadDepth=40                                              | adptive gop encoding                                            |
|           | vp9    |  <br>\-\-qpHdr=\-1 <br>\-\-picRc=1 <br>\-\-effort=2 <br>\-\-mcompFilterType=4 <br>\-\-refFrameScheme=4 <br>\-\-arf\-temporal\-filter\-enabled=0 <br>\-\-passes=2 <br>\-\-lag\-in\-frames=25 | 2\-pass and max lag\-in\-frame setting, effort to 2             |

## Spliter
| Option  | Sub Option | Type | Description             | Range of Value Valid | Default Value |
|---------|------------|------|-------------------------|----------------------|---------------|
| outputs |            | int  | Set number of outputs\. | \[1\.\.4\]           | 1             |


## PP
| Option     | Sub Option | Type   | Description                                          | Range of Value Valid | Default Value |
|------------|------------|--------|------------------------------------------------------|----------------------|---------------|
| outputs    |            | int    | Set number of outputs\.                              | \[1\.\.4\]           | 1             |
| force10bit |            | int    | force output 10bit format                            | \[0\.\.1\]           | 0             |
| low\_res   |            | string | Set output number and resize config for each channel |                      | null          |

Note: low_res is almost same which defined in [decoder filter](#Decoder), the only difference is the streams numbers is not required in vpe_pp filer, for example:
> low_res=(1920x1080)(1280x720)(640x360).

## HWuploader
| Option | Sub Option | Type | Description | Range of Value Valid | Default Value |
|--------|------------|------|-------------|----------------------|---------------|
| /      |            | /    | /           | /                    | /             |
#

# 3.FFmpeg Command Line Examples

## Transcoding

| Case | Target | Source | Output     | 2 Pass   | Command Line Example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------|--------|--------|------------|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID   | Format | Format | Numbers    | Encoding |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 1    | h264   | h264   | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264                                                                                                                                                                                                                                                                                                                      |
| 2    | h264   | h264   | 2          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset fast \-b:v 5000000 out1\.h264                                                                                                                                                                                                        |
| 3    | h264   | hevc   | 3          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset fast \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-preset fast \-b:v 3000000 out2\.h264                                                                                                         |
| 4    | h264   | hevc   | 4          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset fast \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-preset fast \-b:v 3000000 out2\.h264 \-map '\[out3\]' \-c:v h264enc\_vpe \-preset fast \-b:v 500000 out3\.h264          |
| 5    | h264   | vp9    | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264                                                                                                                                                           |
| 6    | h264   | vp9    | 2          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset fast \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset fast \-b:v 5000000 out1\.h264                                                                                                                                                                                                          |
| 7    | hevc   | h264   | 3          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 3000000 out2\.hevc                                                                                                         |
| 8    | hevc   | h264   | 4          | N        |  ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 500000 out3\.hevc         |
| 9    | hevc   | hevc   | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc                                                                                                                                                                                                                                                                                                                      |
| 10   | hevc   | hevc   | 2          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 5000000 out1\.hevc                                                                                                                                                                                                        |
| 11   | hevc   | vp9    | 3          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 3000000 out2\.hevc                                                                                                           |
| 12   | hevc   | vp9    | 4          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset fast \-b:v 500000 out3\.hevc            |
| 13   | vp9    | h264   | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf                                                                                                                                                                                                                                                                                                                        |
| 14   |        |        | 2          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "2:\(360x640\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 5000000 out1\.ivf                                                                                                                                                                                                            |
| 15   | vp9    | hevc   | 3          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 3000000 out2\.ivf                                                                                                               |
| 16   | vp9    | hevc   | 4          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 3000000 out2\.ivf \-map '\[out3\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 500000 out3\.ivf                  |
| 17   | vp9    | vp9    | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf                                                                                                                                                                                                                                                                                                                          |
| 18   | vp9    | vp9    | 2          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset fast \-b:v 5000000 out1\.ivf                                                                                                                                                                                                              |
| 19   | h264   | h264   | 1          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264                                                                                                                                                                                                                                                                                                                    |
| 20   | h264   | h264   | 2          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset medium \-b:v 5000000 out1\.h264                                                                                                                                                                                                    |
| 21   | h264   | hevc   | 3          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset medium \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-preset medium \-b:v 3000000 out2\.h264                                                                                                   |
| 22   | h264   | hevc   | 4          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset medium \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-preset medium \-b:v 3000000 out2\.h264 \-map '\[out3\]' \-c:v h264enc\_vpe \-preset medium \-b:v 500000 out3\.h264  |
| 23   | h264   | vp9    | 1          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264                                                                                                                                                                                                                                                                                                                      |
| 24   | h264   | vp9    | 2          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset medium \-b:v 5000000 out1\.h264                                                                                                                                                                                                      |
| 25   | hevc   | h264   | 3          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 3000000 out2\.hevc                                                                                                   |
| 26   | hevc   | h264   | 4          | Y        |  ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 500000 out3\.hevc |
| 27   | hevc   | hevc   | 1          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc                                                                                                                                                                                                                                                                                                                    |
| 28   | hevc   | hevc   | 2          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc                                                                                                                                                                                                    |
| 29   | hevc   | vp9    | 3          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 3000000 out2\.hevc                                                                                                     |
| 30   | hevc   | vp9    | 4          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 500000 out3\.hevc    |
| 31   | vp9    | h264   | 1          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf                                                                                                                                                                                                                                                                                                                      |
| 32   | vp9    | h264   | 2          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-transcode 1 \-low\_res "2:\(360x640\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 5000000 out1\.ivf                                                                                                                                                                                                        |
| 33   | vp9    | hevc   | 3          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 3000000 out2\.ivf                                                                                                         |
| 34   | vp9    | hevc   | 4          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 3000000 out2\.ivf \-map '\[out3\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 500000 out3\.ivf          |
| 35   | vp9    | vp9    | 1          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf                                                                                                                                                                                                                                                                                                                        |
| 36   | vp9    | vp9    | 2          | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-transcode 1 \-low\_res "2:\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 5000000 out1\.ivf                                                                                                                                                                                                          |
| 37   | VP9    | HEVC   | 1          | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "2:\(d2\)" \-r 30 \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=2\[out0\]\[out1\]' \-map '\[out0\]' \-f null /dev/null \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset medium \-b:v 5000000 out1\.ivf

## Decoding Only

| Case | Target | Source | Output  | 2 Pass   | Command Line Example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------|--------|--------|---------|----------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID   | Format | Format | Numbers | Encoding |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 38   | nv12   | h264   | 4       | NA       | ffmpeg \\-y \-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v h264\_vpe \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=4\[1\]\[2\]\[3\]\[4\],\[1\]hwdownload,format=nv12\[a\],\[2\]hwdownload,format=nv12\[b\],\[3\]hwdownload,format=nv12\[c\],\[4\]hwdownload,format=nv12\[d\]' \-map '\[a\]' out0\.yuv \-map '\[b\]' out1\.yuv \-map '\[c\]' out2\.yuv \-map '\[d\]' out3\.yuv |
| 39   | nv12   | hevc   | 4       | NA       | ffmpeg \\-y \-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v hevc\_vpe \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=4\[1\]\[2\]\[3\]\[4\],\[1\]hwdownload,format=nv12\[a\],\[2\]hwdownload,format=nv12\[b\],\[3\]hwdownload,format=nv12\[c\],\[4\]hwdownload,format=nv12\[d\]' \-map '\[a\]' out0\.yuv \-map '\[b\]' out1\.yuv \-map '\[c\]' out2\.yuv \-map '\[d\]' out3\.yuv |
| 40   | nv12   | vp9    | 4       | NA       | ffmpeg \\-y \-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-c:v vp9\_vpe \-low\_res "4:\(1920x1080\)\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_VP9\} \-filter\_complex 'spliter\_vpe=outputs=4\[1\]\[2\]\[3\]\[4\],\[1\]hwdownload,format=nv12\[a\],\[2\]hwdownload,format=nv12\[b\],\[3\]hwdownload,format=nv12\[c\],\[4\]hwdownload,format=nv12\[d\]' \-map '\[a\]' out0\.yuv \-map '\[b\]' out1\.yuv \-map '\[c\]' out2\.yuv \-map '\[d\]' out3\.yuv   |

## Encoding Only

| Case | Target | Source  | Output  | 2 Pass   | Command Line Example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------|--------|---------|---------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID   | Format | Format  | Numbers | Encoding |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 41   | h264   | yuv420p | 4       | N        | ffmpeg \-y \\-v 48 \-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-s 1920x1080 \-pix\_fmt yuv420p \-i $\{INPUT\_FILE\_RAW\_420P\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:low\_res=\(1920x1080\)\(1280x720\)\(640x360\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 3000000 out2\.h264 \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 500000 out3\.h264 |
| 42   | hevc   | yuv420p | 4       | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-s 1920x1080 \-pix\_fmt yuv420p \-i $\{INPUT\_FILE\_RAW\_420P\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:low\_res=\(1920x1080\)\(1280x720\)\(640x360\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset superfast \-b:v 500000 out3\.hevc        |
| 43   | vp9    | yuv420p | 4       | N        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-r 30 \-s 1920x1080 \-pix\_fmt yuv420p \-i $\{INPUT\_FILE\_RAW\_420P\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:low\_res=\(1920x1080\)\(1280x720\)\(640x360\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset superfast \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset superfast \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset superfast \-b:v 3000000 out2\.ivf \-map '\[out3\]' \-c:v vp9enc\_vpe \-preset superfast \-b:v 500000 out3\.ivf         |
| 44   | h264   | rgb24   | 4       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-r 30 \-s 1920x1080 \-pix\_fmt rgb24 \-i $\{INPUT\_FILE\_RAW\_RGB24\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:low\_res=\(d2\)\(d4\)\(d8\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-preset medium \-b:v 10000000 out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-preset medium \-b:v 5000000 out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-preset medium \-b:v 3000000 out2\.h264 \-map '\[out3\]' \-c:v h264enc\_vpe \-preset medium \-b:v 500000 out3\.h264                                |
| 45   | hevc   | abgr    | 4       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-r 30 \-s 1920x1080 \-pix\_fmt abgr \-i $\{INPUT\_FILE\_RAW\_ABGR\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:force10bit=1:low\_res=\(d2\)\(d4\)\(d8\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 10000000 out0\.hevc \-map '\[out1\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 5000000 out1\.hevc \-map '\[out2\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 3000000 out2\.hevc \-map '\[out3\]' \-c:v hevcenc\_vpe \-preset medium \-b:v 500000 out3\.hevc                     |
| 46   | vp9    | rgba    | 4       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0,priority=vod,vpeloglevel=0 \-r 30 \-s 1920x1080 \-pix\_fmt rgba \-i $\{INPUT\_FILE\_RAW\_RGBA\} \-filter\_hw\_device "dev0" \-filter\_complex 'vpe\_pp=outputs=4:low\_res=\(\-1x1080\)\(\-1x674\)\(\-1x336\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-preset slow \-b:v 10000000 out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-preset slow \-b:v 5000000 out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-preset slow \-b:v 3000000 out2\.ivf \-map '\[out3\]' \-c:v vp9enc\_vpe \-preset slow \-b:v 500000 out3\.ivf                                  |

## Transcoding with parameters

| Case | Target | Source | Output  | 2 Pass   | Command Line Example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------|--------|--------|---------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID   | Format | Format | Numbers | Encoding |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 47   | h264   | h264   | 3       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0 \-c:v h264\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 10000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 5000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 3000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset='2':bitrate\_window=180:intra\_pic\_rate=60" out2\.h264                                                                                                                                                                                                                                                               |
| 48   | h264   | argb   | 4       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0 \-s 1920x1080 \-pix\_fmt argb \-i $\{INPUT\_FILE\_RAW\_ARGB\} \-filter\_hw\_device "dev0" \-filter\_complex "vpe\_pp=outputs=4:force10bit=1:low\_res=\(1920x1080\)\(1280x720\)\(640x360\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]" \-map '\[out0\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 10000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out0\.h264 \-map '\[out1\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 5000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out1\.h264 \-map '\[out2\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 3000000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out2\.h264 \-map '\[out3\]' \-c:v h264enc\_vpe \-profile:v main \-level 5\.2 \-b:v 500000 \-enc\_params "lookahead\_depth=10:chroma\_qp\_offset=2:bitrate\_window=180:intra\_pic\_rate=60" out3\.h264 |
| 49   | vp9    | h264   | 3       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0 \-c:v h264\_vpe \-transcode 1 \-low\_res "3:\(1280x720\)\(640x360\)" \-i $\{INPUT\_FILE\_H264\} \-filter\_complex 'spliter\_vpe=outputs=3\[out0\]\[out1\]\[out2\]' \-map '\[out0\]' \-c:v vp9enc\_vpe \-b:v 10000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-b:v 5000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-b:v 3000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out2\.ivf                                                                                                                                                                                                                                                                                                                 |
| 50   | vp9    | nv12   | 4       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0 \-s 1920x1080 \-pix\_fmt nv12 \-i $\{INPUT\_FILE\_RAW\_NV12\} \-filter\_hw\_device "dev0" \-filter\_complex "vpe\_pp=outputs=4:low\_res=\(1920x1080\)\(1280x720\)\(640x360\),spliter\_vpe=outputs=4\[out0\]\[out1\]\[out2\]\[out3\]" \-map '\[out0\]' \-c:v vp9enc\_vpe \-r 60 \-b:v 10000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out0\.ivf \-map '\[out1\]' \-c:v vp9enc\_vpe \-b:v 5000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out1\.ivf \-map '\[out2\]' \-c:v vp9enc\_vpe \-b:v 3000000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out2\.ivf \-map '\[out3\]' \-c:v vp9enc\_vpe \-b:v 500000 \-enc\_params "ref\_frame\_scheme=4:lag\_in\_frames=18:passes=2:bitrate\_window=60:effort=0:intra\_pic\_rate=60" out3\.ivf                                                                       |

## Downscaling First Pass
| Case | Target | Source | Output  | 2 Pass   | Command Line Example                                                                                                                                                                                                                                                                 |
|------|--------|--------|---------|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ID   | Format | Format | Numbers | Encoding |                                                                                                                                                                                                                                                                                      |
| 51   | h264   | hevc   | 1       | Y        | ffmpeg \-y \\-init\_hw\_device vpe=dev0:/dev/transcoder0 \-c:v hevc\_vpe \-transcode 1 \-low\_res "1:\(d2\)" \-i $\{INPUT\_FILE\_HEVC\} \-filter\_complex 'spliter\_vpe=outputs=1\[out0\]' \-map '\[out0\]' \-c:v h264enc\_vpe  \-preset medium \-b:v 10000000 out0\.h264 |

# 4.Use VPE in K8S

If you's are running VPE on Solios-X platform, please follow below link to know how to let it working under k8s:
https://github.com/VeriSilicon/solios-x-device-plugin
